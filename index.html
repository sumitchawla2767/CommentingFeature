<!doctype html>
<html>
<head>
    <meta charset=utf-8>
    <meta name=description content="">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <title>Jquery Comments Plugin</title>

    <!-- Styles -->
    <link rel="stylesheet" href="./sass/style.css" type="text/css" media="all">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <!-- Data -->
    <script type="text/javascript" src="comments-data.js"></script>

    <!-- Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.textcomplete/1.8.0/jquery.textcomplete.js"></script>
    <script type="text/javascript" src="index.js"></script>

    <style type="text/css">
        body {
            padding: 20px;
            margin: 0;
            font-size: 14px;
            font-family: "Arial", Georgia, Serif;
        }
    </style>

    <!-- Init jquery-comments -->
    <script type="text/javascript">
        $(function() {
            var saveComment = function(data) {

                // Convert pings to human readable format
                $(Object.keys(data.pings)).each(function(index, userId) {
                    var fullname = data.pings[userId];
                    var pingText = '@' + fullname;
                    data.content = data.content.replace(new RegExp('@' + userId, 'g'), pingText);
                });

                return data;
            };

            fileArray.forEach((el, index) => {
                $('#comments-container' + index).comments({
                    profilePictureURL: el.profilePictureURL,
                    currentUserId: el.currentUserId,
                    roundProfilePictures: el.roundProfilePictures,
                    textareaRows: el.textareaRows,
                    enableAttachments: el.enableAttachments,
                    enableHashtags: el.enableHashtags,
                    enablePinging: el.enablePinging,
                    searchUsers: function(term, success, error) {
                        setTimeout(function() {
                            success(usersArray.filter(function(user) {
                                var containsSearchTerm = user.fullname.toLowerCase().indexOf(term.toLowerCase()) != -1;
                                var isNotSelf = user.id != 1;
                                return containsSearchTerm && isNotSelf;
                            }));
                        }, 500);
                    },
                    getComments: function(success, error) {
                        setTimeout(function() {
                            success(commentsArray);
                        }, 500);
                    },
                    postComment: function(data, success, error) {
                        setTimeout(function() {
                            success(saveComment(data));
                        }, 500);
                    },
                    putComment: function(data, success, error) {
                        setTimeout(function() {
                            success(saveComment(data));
                        }, 500);
                    },
                    deleteComment: function(data, success, error) {
                        setTimeout(function() {
                            success();
                        }, 500);
                    }
                })
            });



        });
    </script>

</head>
<body>
<div class="commenting">
    <div id="comments-container0"></div>
    <div id="comments-container1"></div>
</div>
</body>
</html>
